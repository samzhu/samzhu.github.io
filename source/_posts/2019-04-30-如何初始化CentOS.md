---
title: 如何初始化 CentOS
date: 2019-04-30 12:00:00
categories:
  - DevOps
tags:
  - OS
---

最近搞了好一陣子自動化, 接下來會整理整個 CI CD 怎麼處理

首先你要先初始化幾台基礎服務, 首先就是 初始化作業系統XD

<!--more-->

# 關閉SELINUX (建議執行)

## 立即生效
```
sudo setenforce 0
```
## 永久生效
```
sudo sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config
```

# 設定時區
```
sudo timedatectl set-timezone Asia/Shanghai
sudo ls -l /etc/localtime
```

# 禁用SSH 遠程主機的公鑰檢查詢問
```
sudo sed -i 's/#   StrictHostKeyChecking ask/StrictHostKeyChecking no/g' /etc/ssh/ssh_config
```
## 重啟SSH服務使其生效
```
sudo service sshd restart
```

# 安裝常用工具
```
sudo yum install epel-release -y
sudo yum update -y
sudo yum install tree -y
sudo yum install telnet -y
sudo yum install net-tools -y
sudo yum install -y yum-utils device-mapper-persistent-data lvm2
```

# Docker
[https://docs.docker.com/install/linux/docker-ce/centos/](https://docs.docker.com/install/linux/docker-ce/centos/)
## 安裝
```
sudo yum install -y yum-utils \
  device-mapper-persistent-data \
  lvm2

sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo

sudo yum install -y docker-ce
```
## 設定開機啟動
https://docs.docker.com/install/linux/linux-postinstall/#configure-docker-to-start-on-boot
```
sudo systemctl enable docker
```
## 手動啟動
```
sudo systemctl start docker
```

# Docker Compose
[https://docs.docker.com/compose/install/](https://docs.docker.com/compose/install/)

## 安裝
```
sudo curl -L "https://github.com/docker/compose/releases/download/1.23.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

## 建立捷徑給 sudo 使用
```
sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
```
之後使用 sudo docker-compose up

## 將當前用戶加入 Docker 群組(不採用)
```
sudo gpasswd -a ${USER} docker
```
之後使用 docker-compose up

# 沒有 內部DNS 所以域名會對應到外部 IP, 安全規則限制會不通
```
sudo bash -c 'cat > /etc/hosts' << 'EOF'
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
172.31.43.121  gitlab.samchu.com
172.31.43.121  docker-registry.samchu.com
EOF
```

# 完成 重開機
```
sudo reboot
```

<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="創用 CC 授權條款" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">SAM的程式筆記 </span>由<a xmlns:cc="http://creativecommons.org/ns#" href="https://blog.samchu.dev/" property="cc:attributionName" rel="cc:attributionURL">朱尚禮</a>製作，以<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">創用CC 姓名標示-非商業性-相同方式分享 4.0 國際 授權條款</a>釋出。