<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.samzhu.dev","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.18.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="This project uses Spring Authorization Server to establish an authorization system that conforms to the OAuth 2.1 specification and uses JWT Token to be issued.">
<meta property="og:type" content="article">
<meta property="og:title" content="Getting Started Spring Authorization Server">
<meta property="og:url" content="https://blog.samzhu.dev/2021/10/26/Getting-Started-Spring-Authorization-Server/index.html">
<meta property="og:site_name" content="Sam&#39;s programming note">
<meta property="og:description" content="This project uses Spring Authorization Server to establish an authorization system that conforms to the OAuth 2.1 specification and uses JWT Token to be issued.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.imgur.com/uUfD1jA.jpg">
<meta property="og:image" content="https://i.imgur.com/pi7ldhi.png">
<meta property="og:image" content="https://i.imgur.com/6dVgsu2.png">
<meta property="og:image" content="https://i.imgur.com/RSu2hCf.png">
<meta property="og:image" content="https://i.imgur.com/uQd40aM.png">
<meta property="article:published_time" content="2021-10-26T09:16:22.000Z">
<meta property="article:modified_time" content="2025-07-24T15:41:45.581Z">
<meta property="article:author" content="Sam Zhu">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="OAuth">
<meta property="article:tag" content="Security">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/uUfD1jA.jpg">
<meta name="twitter:creator" content="@samzhu0318">


<link rel="canonical" href="https://blog.samzhu.dev/2021/10/26/Getting-Started-Spring-Authorization-Server/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://blog.samzhu.dev/2021/10/26/Getting-Started-Spring-Authorization-Server/","path":"2021/10/26/Getting-Started-Spring-Authorization-Server/","title":"Getting Started Spring Authorization Server"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Getting Started Spring Authorization Server | Sam's programming note</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CFLHEYEETG"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-CFLHEYEETG","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>







<meta name="google-adsense-account" content="ca-pub-5880479202699914">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5880479202699914"
     crossorigin="anonymous"></script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Sam's programming note</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-demo-project"><span class="nav-number">1.</span> <span class="nav-text">Create demo project</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Table-Schema"><span class="nav-number">2.</span> <span class="nav-text">Table Schema</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#How-to-implement"><span class="nav-number">3.</span> <span class="nav-text">How to implement</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AbstractUserDetailsAuthenticationProvider"><span class="nav-number">3.1.</span> <span class="nav-text">AbstractUserDetailsAuthenticationProvider</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UserDetailsService"><span class="nav-number">3.2.</span> <span class="nav-text">UserDetailsService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#oauth2-client"><span class="nav-number">3.3.</span> <span class="nav-text">oauth2 client</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OAuth2AuthorizationService"><span class="nav-number">3.4.</span> <span class="nav-text">OAuth2AuthorizationService</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OAuth2TokenCustomizer"><span class="nav-number">3.5.</span> <span class="nav-text">OAuth2TokenCustomizer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Configuration"><span class="nav-number">4.</span> <span class="nav-text">Configuration</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Generate-RSA-Key"><span class="nav-number">4.1.</span> <span class="nav-text">Generate RSA Key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AuthorizationServerConfig"><span class="nav-number">4.2.</span> <span class="nav-text">AuthorizationServerConfig</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DefaultSecurityConfig"><span class="nav-number">4.3.</span> <span class="nav-text">DefaultSecurityConfig</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#test"><span class="nav-number">5.</span> <span class="nav-text">test</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Get-public-key"><span class="nav-number">5.1.</span> <span class="nav-text">Get public key</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Use-OpenID-Connect-debugger-to-test"><span class="nav-number">5.2.</span> <span class="nav-text">Use OpenID Connect debugger to test</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Test-client-credentials"><span class="nav-number">5.3.</span> <span class="nav-text">Test client credentials</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Customized-page"><span class="nav-number">6.</span> <span class="nav-text">Customized page</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Consent-page"><span class="nav-number">6.1.</span> <span class="nav-text">Consent page</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">7.</span> <span class="nav-text">Reference</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Sam Zhu"
      src="https://i.imgur.com/eLloI4N.png">
  <p class="site-author-name" itemprop="name">Sam Zhu</p>
  <div class="site-description" itemprop="description">Hello, I'm Sam, a tech-savvy blogger with a passion for programming. I share insights on programming, cloud computing, and more, including topics like SpringBoot, SpringCloud, GCP. My blog aims to assist both newcomers and professionals in these fields.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">59</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">74</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/samzhu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;samzhu" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/samzhu0318" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;samzhu0318" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blog.samzhu.dev/2021/10/26/Getting-Started-Spring-Authorization-Server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.imgur.com/eLloI4N.png">
      <meta itemprop="name" content="Sam Zhu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sam's programming note">
      <meta itemprop="description" content="Hello, I'm Sam, a tech-savvy blogger with a passion for programming. I share insights on programming, cloud computing, and more, including topics like SpringBoot, SpringCloud, GCP. My blog aims to assist both newcomers and professionals in these fields.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Getting Started Spring Authorization Server | Sam's programming note">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Getting Started Spring Authorization Server
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-10-26 17:16:22" itemprop="dateCreated datePublished" datetime="2021-10-26T17:16:22+08:00">2021-10-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-07-24 23:41:45" itemprop="dateModified" datetime="2025-07-24T23:41:45+08:00">2025-07-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><img src="https://i.imgur.com/uUfD1jA.jpg" alt="cover"></p>
<p>This project uses <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-authorization-server">Spring Authorization Server</a> to establish an authorization system that conforms to the OAuth 2.1 specification and uses JWT Token to be issued.</p>
<span id="more"></span>

<p>Spring Authorization Server This is a community-driven project led by the Spring Security team, focusing on providing authorization server support for the Spring community. This project has also begun to replace the Authorization Server support provided by Spring Security OAuth.  </p>
<p>Spring officially announced on 2021&#x2F;8&#x2F;19 that Spring Authorization Server has officially withdrawn from the experimental state and entered the product family of the Spring project!  </p>
<p>Since the announcement of the Spring Authorization Server in April 2020, it has implemented most of the OAuth 2.1 authorization protocol and provided moderate support for OpenID Connect 1.0. As the project enters the next stage of development, its focus will shift to advancing support for OpenID Connect 1.0.  </p>
<p>OAuth 2.1 no longer supports password grant type, so Spring Authorization Server does not implement password grant type authentication.  </p>
<h2 id="Create-demo-project"><a href="#Create-demo-project" class="headerlink" title="Create demo project"></a>Create demo project</h2><p>Version info</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Version</th>
</tr>
</thead>
<tbody><tr>
<td>SpringBoot</td>
<td>2.5.6</td>
</tr>
<tr>
<td>PostgreSQL</td>
<td>13.3</td>
</tr>
</tbody></table>
<p>Download template <a target="_blank" rel="noopener" href="https://start.spring.io/#!type=gradle-project&language=java&platformVersion=2.5.6&packaging=jar&jvmVersion=11&groupId=com.example&artifactId=demo&name=demo&description=Demo%20project%20for%20auth%20server&packageName=com.example.demo&dependencies=data-jpa,security,web,validation,thymeleaf,liquibase,lombok,devtools,postgresql">Spring Initalizr</a>  </p>
<p>You can refer to this project <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-authorization-server/tree/main/samples/boot/oauth2-integration/authorizationserver">authorizationserver</a> to create an Authserver.</p>
<p>But my requirement here is to use PostgreSQL, so I have to customize my DB Table &amp; OAuth2AuthorizationService. My example uses Liquibase for version control, and the table is built during the service startup phase.  </p>
<h2 id="Table-Schema"><a href="#Table-Schema" class="headerlink" title="Table Schema"></a>Table Schema</h2><p>If you need reference, you can refer to the following SQL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for resource_scope</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> resource_scope (</span><br><span class="line">  id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  resource <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">scope</span> <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  description <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  created_date <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  created_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  last_modified_date <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  last_modified_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Comment for table resource_scope</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">TABLE</span> resource_scope <span class="keyword">IS</span> <span class="string">&#x27;Access authority information&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> resource_scope.resource <span class="keyword">IS</span> <span class="string">&#x27;resources name&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> resource_scope.scope <span class="keyword">IS</span> <span class="string">&#x27;access scope&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> resource_scope.description <span class="keyword">IS</span> <span class="string">&#x27;description&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Constraint for table resource_scope</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> resource_scope <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_resource_scope <span class="keyword">PRIMARY</span> KEY(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> resource_scope <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uk_resource_scope_scope <span class="keyword">UNIQUE</span> (<span class="keyword">scope</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> resource_scope <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uk_resource_scope_resource_scope <span class="keyword">UNIQUE</span> (resource, <span class="keyword">scope</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for user_account</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_account (</span><br><span class="line">  id <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  user_name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  user_password <span class="type">varchar</span>(<span class="number">60</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  enabled <span class="type">boolean</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  account_non_expired <span class="type">boolean</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  account_non_locked <span class="type">boolean</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  credentials_non_expired <span class="type">boolean</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  created_date <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  created_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  last_modified_date <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  last_modified_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Comment for table user_account</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">TABLE</span> user_account <span class="keyword">IS</span> <span class="string">&#x27;Account information&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> user_account.user_name <span class="keyword">IS</span> <span class="string">&#x27;user account&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> user_account.user_password <span class="keyword">IS</span> <span class="string">&#x27;user password&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> user_account.enabled <span class="keyword">IS</span> <span class="string">&#x27;enable&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> user_account.account_non_expired <span class="keyword">IS</span> <span class="string">&#x27;expired&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> user_account.account_non_locked <span class="keyword">IS</span> <span class="string">&#x27;account locked&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> user_account.credentials_non_expired <span class="keyword">IS</span> <span class="string">&#x27;certificate has expired &#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Constraint for table user_account</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_account <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_user_account <span class="keyword">PRIMARY</span> KEY(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_account <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uk_user_account <span class="keyword">UNIQUE</span> (user_name);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for user_group</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_group (</span><br><span class="line">  id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  code <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  created_date <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  created_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  last_modified_date <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  last_modified_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Comment for table user_group</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">TABLE</span> user_group <span class="keyword">IS</span> <span class="string">&#x27;Group data&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> user_group.code <span class="keyword">IS</span> <span class="string">&#x27;Group code&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> user_group.name <span class="keyword">IS</span> <span class="string">&#x27;Group name&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Constraint for table user_group</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_group <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_user_group <span class="keyword">PRIMARY</span> KEY(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_group <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uk_user_group <span class="keyword">UNIQUE</span> (name);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for user_group_member</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_group_member (</span><br><span class="line">  id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  user_id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  user_group_id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  created_date <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  created_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  last_modified_date <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  last_modified_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Comment for table user_group_member</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">TABLE</span> user_group_member <span class="keyword">IS</span> <span class="string">&#x27;User group corresponding data&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> user_group_member.user_id <span class="keyword">IS</span> <span class="string">&#x27;Account ID&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> user_group_member.user_group_id <span class="keyword">IS</span> <span class="string">&#x27;Group ID&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Constraint for table user_group_member</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_group_member <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_user_group_member <span class="keyword">PRIMARY</span> KEY(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_group_member <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uk_user_group_member <span class="keyword">UNIQUE</span> (user_id, user_group_id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_group_member <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_user_group_member_user_id <span class="keyword">FOREIGN</span> KEY (user_id) <span class="keyword">REFERENCES</span> user_account(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_group_member <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_user_group_member_user_group_id <span class="keyword">FOREIGN</span> KEY (user_group_id) <span class="keyword">REFERENCES</span> user_group(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for user_group_scope</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user_group_scope (</span><br><span class="line">  id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  user_group_id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  resource_scope_id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  created_date <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  created_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  last_modified_date <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  last_modified_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Comment for table user_group_scope</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">TABLE</span> user_group_scope <span class="keyword">IS</span> <span class="string">&#x27;Group permissions data&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> user_group_scope.user_group_id <span class="keyword">IS</span> <span class="string">&#x27;Group ID&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> user_group_scope.resource_scope_id <span class="keyword">IS</span> <span class="string">&#x27;Resource scope ID&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Constraint for table user_group_authority</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_group_scope <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_user_group_scope <span class="keyword">PRIMARY</span> KEY(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_group_scope <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uk_user_group_scope <span class="keyword">UNIQUE</span> (user_group_id, resource_scope_id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_group_scope <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_user_group_scope_user_group_id <span class="keyword">FOREIGN</span> KEY (user_group_id) <span class="keyword">REFERENCES</span> user_group(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">NO</span> ACTION <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">NO</span> ACTION;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_group_scope <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_user_group_scope_resource_scope_id <span class="keyword">FOREIGN</span> KEY (resource_scope_id) <span class="keyword">REFERENCES</span> resource_scope(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">NO</span> ACTION <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">NO</span> ACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for oauth2_client</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> oauth2_client (</span><br><span class="line">  id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  client_id <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  client_id_issued_at <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  client_secret <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  client_secret_expires_at <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  client_name <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  created_date <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  created_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  last_modified_date <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  last_modified_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Comment for table oauth2_client</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">TABLE</span> oauth2_client <span class="keyword">IS</span> <span class="string">&#x27;OAuth Client&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client.client_id <span class="keyword">IS</span> <span class="string">&#x27;Client account&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client.client_id_issued_at <span class="keyword">IS</span> <span class="string">&#x27;issuing time&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client.client_secret <span class="keyword">IS</span> <span class="string">&#x27;secret&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client.client_secret_expires_at <span class="keyword">IS</span> <span class="string">&#x27;Secret expiration time&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client.client_name <span class="keyword">IS</span> <span class="string">&#x27;name&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Constraint for table oauth2_client</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_oauth2_client <span class="keyword">PRIMARY</span> KEY(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uk_oauth2_client <span class="keyword">UNIQUE</span> (client_id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for oauth2_client_authentication_method</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> oauth2_client_authentication_method (</span><br><span class="line">  id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  oauth2_client_id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  authentication_method <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  created_date <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  created_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  last_modified_date <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  last_modified_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Comment for table oauth2_client_authentication_method</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">TABLE</span> oauth2_client_authentication_method <span class="keyword">IS</span> <span class="string">&#x27;oauth client verification method&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client_authentication_method.oauth2_client_id <span class="keyword">IS</span> <span class="string">&#x27;OAuth Client ID&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client_authentication_method.authentication_method <span class="keyword">IS</span> <span class="string">&#x27;verification method&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Constraint for table oauth2_client_authentication_method</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_authentication_method <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_oauth2_client_authentication_method <span class="keyword">PRIMARY</span> KEY(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_authentication_method <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uk_oauth2_client_authentication_method <span class="keyword">UNIQUE</span> (oauth2_client_id, authentication_method);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_authentication_method <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_oauth2_client_authentication_method_oauth2_client_id <span class="keyword">FOREIGN</span> KEY (oauth2_client_id) <span class="keyword">REFERENCES</span> oauth2_client(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for oauth2_client_grant_type</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> oauth2_client_grant_type (</span><br><span class="line">  id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  oauth2_client_id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  grant_type <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  created_date <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  created_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  last_modified_date <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  last_modified_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Comment for table oauth2_client_grant_type</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">TABLE</span> oauth2_client_grant_type <span class="keyword">IS</span> <span class="string">&#x27;oauth client authorization method&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client_grant_type.oauth2_client_id <span class="keyword">IS</span> <span class="string">&#x27;OAuth Client ID&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client_grant_type.grant_type <span class="keyword">IS</span> <span class="string">&#x27;Authorization method&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Constraint for table oauth2_client_authentication_method</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_grant_type <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_oauth2_client_grant_type <span class="keyword">PRIMARY</span> KEY(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_grant_type <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uk_oauth2_client_grant_type <span class="keyword">UNIQUE</span> (oauth2_client_id, grant_type);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_grant_type <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_oauth2_client_grant_type_oauth2_client_id <span class="keyword">FOREIGN</span> KEY (oauth2_client_id) <span class="keyword">REFERENCES</span> oauth2_client(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for oauth2_client_redirect_uri</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> oauth2_client_redirect_uri (</span><br><span class="line">  id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  oauth2_client_id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  redirect_uri <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  created_date <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  created_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  last_modified_date <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  last_modified_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Comment for table oauth2_client_redirect_uri</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">TABLE</span> oauth2_client_redirect_uri <span class="keyword">IS</span> <span class="string">&#x27;oauth client redirection URL&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client_redirect_uri.oauth2_client_id <span class="keyword">IS</span> <span class="string">&#x27;OAuth Client ID&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client_redirect_uri.redirect_uri <span class="keyword">IS</span> <span class="string">&#x27;Redirection URL&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Constraint for table oauth2_client_redirect_uri</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_redirect_uri <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_oauth2_client_redirect_uri <span class="keyword">PRIMARY</span> KEY(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_redirect_uri <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uk_oauth2_client_redirect_uri <span class="keyword">UNIQUE</span> (oauth2_client_id, redirect_uri);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_redirect_uri <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_oauth2_client_redirect_uri_oauth2_client_id <span class="keyword">FOREIGN</span> KEY (oauth2_client_id) <span class="keyword">REFERENCES</span> oauth2_client(id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for oauth2_client_scope</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> oauth2_client_scope (</span><br><span class="line">  id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  oauth2_client_id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  resource_scope_id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  created_date <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  created_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  last_modified_date <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  last_modified_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Comment for table oauth2_client_scope</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">TABLE</span> oauth2_client_scope <span class="keyword">IS</span> <span class="string">&#x27;client scope&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client_scope.oauth2_client_id <span class="keyword">IS</span> <span class="string">&#x27;OAuth Client ID&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client_scope.resource_scope_id <span class="keyword">IS</span> <span class="string">&#x27;scope ID&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Constraint for table oauth2_client_scope</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_scope <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_oauth2_client_scope <span class="keyword">PRIMARY</span> KEY(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_scope <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uk_oauth2_client_scope <span class="keyword">UNIQUE</span> (oauth2_client_id, resource_scope_id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_scope <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_oauth2_client_scope_oauth2_client_id <span class="keyword">FOREIGN</span> KEY (oauth2_client_id) <span class="keyword">REFERENCES</span> oauth2_client(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_scope <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_oauth2_client_scope_resource_scope_id <span class="keyword">FOREIGN</span> KEY (resource_scope_id) <span class="keyword">REFERENCES</span> resource_scope(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for oauth2_client_setting</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> oauth2_client_setting (</span><br><span class="line">  id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  oauth2_client_id <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  property_type <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  property_name <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  property_value <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  created_date <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  created_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  last_modified_date <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  last_modified_by <span class="type">varchar</span>(<span class="number">36</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Comment for table oauth2_client_setting</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">TABLE</span> oauth2_client_setting <span class="keyword">IS</span> <span class="string">&#x27;client config&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client_setting.oauth2_client_id <span class="keyword">IS</span> <span class="string">&#x27;OAuth Client ID&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client_setting.property_type <span class="keyword">IS</span> <span class="string">&#x27;Type of setting&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client_setting.property_name <span class="keyword">IS</span> <span class="string">&#x27;Attribute name&#x27;</span>;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">COLUMN</span> oauth2_client_setting.property_value <span class="keyword">IS</span> <span class="string">&#x27;Attribute value&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Constraint for table oauth2_client_setting</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_setting <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_oauth2_client_setting <span class="keyword">PRIMARY</span> KEY(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_setting <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uk_oauth2_client_setting <span class="keyword">UNIQUE</span> (oauth2_client_id, property_type, property_name);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_client_setting <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_oauth2_client_setting_oauth2_client_id <span class="keyword">FOREIGN</span> KEY (oauth2_client_id) <span class="keyword">REFERENCES</span> oauth2_client(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- OAuth Reference source</span></span><br><span class="line"><span class="comment">-- https://github.com/spring-projects/spring-authorization-server/blob/main/oauth2-authorization-server/src/main/resources/org/springframework/security/oauth2/server/authorization/oauth2-authorization-schema.sql</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> oauth2_authorization (</span><br><span class="line">  id <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  registered_client_id <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  principal_name <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  authorization_grant_type <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  attributes <span class="type">varchar</span>(<span class="number">4000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  state <span class="type">varchar</span>(<span class="number">500</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  authorization_code_value text <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  authorization_code_issued_at <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  authorization_code_expires_at <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  authorization_code_metadata <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  access_token_value text <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  access_token_issued_at <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  access_token_expires_at <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  access_token_metadata <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  access_token_type <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  access_token_scopes <span class="type">varchar</span>(<span class="number">1000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  oidc_id_token_value text <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  oidc_id_token_issued_at <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  oidc_id_token_expires_at <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  oidc_id_token_metadata <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  refresh_token_value text <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  refresh_token_issued_at <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  refresh_token_expires_at <span class="type">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  refresh_token_metadata <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_authorization <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_oauth2_authorization <span class="keyword">PRIMARY</span> KEY(id);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> oauth2_authorization_consent (</span><br><span class="line">  registered_client_id <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  principal_name <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">  authorities <span class="type">varchar</span>(<span class="number">1000</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> oauth2_authorization_consent <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> pk_oauth2_authorization_consent <span class="keyword">PRIMARY</span> KEY(registered_client_id, principal_name);</span><br></pre></td></tr></table></figure>

<p>and initialization data</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> resource_scope(id, resource, <span class="keyword">scope</span>, description, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;oauth&#x27;</span>, <span class="string">&#x27;openid&#x27;</span>, <span class="string">&#x27;Identification&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> resource_scope(id, resource, <span class="keyword">scope</span>, description, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;Personal information&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;１&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_account</span><br><span class="line">(id, user_name, user_password, enabled, account_non_expired, account_non_locked, credentials_non_expired, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;$2a$10$oaeeokjBmMdYIRQBzz8cde2Z1CxPIE7kfStPI4WeKNwfItbYJxE/W&#x27;</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_group(id, code, name, created_date, created_by, last_modified_date, last_modified_by) </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;ADMIN&#x27;</span>, <span class="string">&#x27;Manage groups&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_group_member(id, user_id, user_group_id, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> user_group_scope(id, user_group_id, resource_scope_id, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client(id, client_id, client_id_issued_at, client_secret, client_secret_expires_at, client_name, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;democlient&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;$2a$10$c85hYXPx4niZCCkmxeqXHOriQvvaWBSd9SVpYoq2ZAbs0uUa1ESL.&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;demo&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_authentication_method(id, oauth2_client_id, authentication_method, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;client_secret_post&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_authentication_method(id, oauth2_client_id, authentication_method, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;client_secret_basic&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_grant_type(id, oauth2_client_id, grant_type, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;authorization_code&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_grant_type(id, oauth2_client_id, grant_type, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;refresh_token&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_grant_type(id, oauth2_client_id, grant_type, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;client_credentials&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_redirect_uri(id, oauth2_client_id, redirect_uri, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;https://oidcdebugger.com/debug&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_scope(id, oauth2_client_id, resource_scope_id, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_scope(id, oauth2_client_id, resource_scope_id, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_setting(id, oauth2_client_id, property_type, property_name, property_value, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;client&#x27;</span>, <span class="string">&#x27;require-proof-key&#x27;</span>, <span class="string">&#x27;false&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_setting(id, oauth2_client_id, property_type, property_name, property_value, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;client&#x27;</span>, <span class="string">&#x27;require-authorization-consent&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_setting(id, oauth2_client_id, property_type, property_name, property_value, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;id-token-signature-algorithm&#x27;</span>, <span class="string">&#x27;RS256&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_setting(id, oauth2_client_id, property_type, property_name, property_value, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;access-token-time-to-live&#x27;</span>, <span class="string">&#x27;300&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_setting(id, oauth2_client_id, property_type, property_name, property_value, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;refresh-token-time-to-live&#x27;</span>, <span class="string">&#x27;3600&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> oauth2_client_setting(id, oauth2_client_id, property_type, property_name, property_value, created_date, created_by, last_modified_date, last_modified_by)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;token&#x27;</span>, <span class="string">&#x27;reuse-refresh-tokens&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>, <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;1&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>After executing the initialization sql file, You create a user account <code>admin</code> password <code>1234</code> and oauth client name <code>democlient</code> secret <code>123456</code>.  </p>
<h2 id="How-to-implement"><a href="#How-to-implement" class="headerlink" title="How to implement"></a>How to implement</h2><p>Here are a few things that you must implement yourself to meet your needs.</p>
<h3 id="AbstractUserDetailsAuthenticationProvider"><a href="#AbstractUserDetailsAuthenticationProvider" class="headerlink" title="AbstractUserDetailsAuthenticationProvider"></a>AbstractUserDetailsAuthenticationProvider</h3><p>First, you must provide the user’s search and authentication password implementation, you can inherit from org.springframework.security.authentication.dao.AbstractUserDetailsAuthenticationProvider</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomUserDetailsAuthenticationProvider</span></span><br><span class="line">    <span class="keyword">extends</span> <span class="title class_">AbstractUserDetailsAuthenticationProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line">  <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">additionalAuthenticationChecks</span><span class="params">(</span></span><br><span class="line"><span class="params">      UserDetails userDetails, UsernamePasswordAuthenticationToken authentication)</span></span><br><span class="line">      <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">    log.debug(</span><br><span class="line">        <span class="string">&quot;&gt;&gt; CustomUserDetailsAuthenticationProvider.additionalAuthenticationChecks userDetails=&#123;&#125;, authentication=&#123;&#125;&quot;</span>,</span><br><span class="line">        userDetails,</span><br><span class="line">        authentication);</span><br><span class="line">    <span class="keyword">if</span> (authentication.getCredentials() == <span class="literal">null</span> || userDetails.getPassword() == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadCredentialsException</span>(<span class="string">&quot;Credentials may not be null.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    log.debug(</span><br><span class="line">        <span class="string">&quot;credentials=&#123;&#125;, password=&#123;&#125;&quot;</span>, authentication.getCredentials(), userDetails.getPassword());</span><br><span class="line">    <span class="keyword">if</span> (!passwordEncoder.matches(</span><br><span class="line">        (String) authentication.getCredentials(), userDetails.getPassword())) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadCredentialsException</span>(<span class="string">&quot;Invalid username or password&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    log.debug(<span class="string">&quot;&lt;&lt; CustomUserDetailsAuthenticationProvider.additionalAuthenticationChecks&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> UserDetails <span class="title function_">retrieveUser</span><span class="params">(</span></span><br><span class="line"><span class="params">      String username, UsernamePasswordAuthenticationToken authentication)</span></span><br><span class="line">      <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">    log.debug(</span><br><span class="line">        <span class="string">&quot;&gt;&gt; CustomUserDetailsAuthenticationProvider.retrieveUser username=&#123;&#125;, authentication=&#123;&#125;&quot;</span>,</span><br><span class="line">        username,</span><br><span class="line">        authentication);</span><br><span class="line">    <span class="type">UserDetails</span> <span class="variable">userDetails</span> <span class="operator">=</span> userDetailsService.loadUserByUsername(username);</span><br><span class="line">    log.debug(</span><br><span class="line">        <span class="string">&quot;&lt;&lt; CustomUserDetailsAuthenticationProvider.retrieveUser UserDetails=&#123;&#125;&quot;</span>, userDetails);</span><br><span class="line">    <span class="keyword">return</span> userDetails;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UserDetailsService"><a href="#UserDetailsService" class="headerlink" title="UserDetailsService"></a>UserDetailsService</h3><p>Then provide an implementation of returning org.springframework.security.core.userdetails.UserDetails.  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomUserDetailsService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> UserAccountEntityRepository userAccountRepository;</span><br><span class="line">  <span class="keyword">private</span> UserGroupMemberEntityRepository userGroupMemberRepository;</span><br><span class="line">  <span class="keyword">private</span> UserGroupEntityRepository userGroupRepository;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;&gt;&gt; CustomUserDetailsService.loadUserByUsername username=&#123;&#125;&quot;</span>, username);</span><br><span class="line">    <span class="type">User</span> <span class="variable">userDetails</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    Optional&lt;UserAccountEntity&gt; userOptional = userAccountRepository.findByUserName(username);</span><br><span class="line">    <span class="comment">// Not found...</span></span><br><span class="line">    userOptional.orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">BadCredentialsException</span>(<span class="string">&quot;Invalid username or password&quot;</span>));</span><br><span class="line">    <span class="type">UserAccountEntity</span> <span class="variable">user</span> <span class="operator">=</span> userOptional.get();</span><br><span class="line">    List&lt;UserGroupMemberEntity&gt; userGroupMembers =</span><br><span class="line">        userGroupMemberRepository.findByUserId(user.getId());</span><br><span class="line">    <span class="keyword">if</span> (userGroupMembers.size() == <span class="number">0</span>) &#123;</span><br><span class="line">      userDetails =</span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">User</span>(</span><br><span class="line">              user.getUserName(),</span><br><span class="line">              user.getUserPassword(),</span><br><span class="line">              user.getEnabled(), <span class="comment">// it&#x27;s usable or not</span></span><br><span class="line">              !user.getAccountNonExpired(), <span class="comment">// Is it expired</span></span><br><span class="line">              !user.getCredentialsNonExpired(), <span class="comment">// The certificate does not expire is true</span></span><br><span class="line">              !user.getAccountNonLocked(), <span class="comment">// Account is not locked to true</span></span><br><span class="line">              AuthorityUtils.NO_AUTHORITIES);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      List&lt;String&gt; userGroupIds =</span><br><span class="line">          userGroupMembers.stream()</span><br><span class="line">              .map(UserGroupMemberEntity::getUserGroupId)</span><br><span class="line">              .collect(Collectors.toList());</span><br><span class="line">      List&lt;UserGroupEntity&gt; userGroups = userGroupRepository.findByIdIn(userGroupIds);</span><br><span class="line">      Collection&lt;GrantedAuthority&gt; grantedAuthorities = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;GrantedAuthority&gt;();</span><br><span class="line">      <span class="keyword">for</span> (UserGroupEntity userGroup : userGroups) &#123;</span><br><span class="line">        grantedAuthorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(userGroup.getCode()));</span><br><span class="line">      &#125;</span><br><span class="line">      userDetails =</span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">User</span>(</span><br><span class="line">              user.getUserName(),</span><br><span class="line">              user.getUserPassword(),</span><br><span class="line">              user.getEnabled(), <span class="comment">// it&#x27;s usable or not</span></span><br><span class="line">              !user.getAccountNonExpired(), <span class="comment">// Is it expired</span></span><br><span class="line">              !user.getCredentialsNonExpired(), <span class="comment">// The certificate does not expire is true</span></span><br><span class="line">              !user.getAccountNonLocked(), <span class="comment">// Account is not locked to true</span></span><br><span class="line">              grantedAuthorities);</span><br><span class="line">    &#125;</span><br><span class="line">    log.debug(<span class="string">&quot;&lt;&lt; CustomUserDetailsService.loadUserByUsername User=&#123;&#125;&quot;</span>, userDetails);</span><br><span class="line">    <span class="keyword">return</span> userDetails;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>At this stage, I can complete the user’s group corresponding query together.</p>
<h3 id="oauth2-client"><a href="#oauth2-client" class="headerlink" title="oauth2 client"></a>oauth2 client</h3><p>In the original [oauth2-registered-client-schema.sql](<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-authorization-server/blob/main/oauth2-authorization-server/src/main/resources/org">https://github.com/spring-projects/spring-authorization-server/blob/main/oauth2-authorization-server/src/main/resources/org</a> &#x2F;springframework&#x2F;security&#x2F;oauth2&#x2F;server&#x2F;authorization&#x2F;client&#x2F;oauth2-registered-client-schema.sql) you can find the length field of <code>client_settings varchar(2000)</code>, this is because some attributes are different It is converted into a JSON structure and stored in such a field, so I made a little customized adjustment and stored it in the oauth2_client_setting table. You may not need to do this, but if you need it, you can refer to the following implementation.  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomRegisteredClientRepository</span> <span class="keyword">implements</span> <span class="title class_">RegisteredClientRepository</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Oauth2ClientEntityRepository oauth2ClientEntityRepository;</span><br><span class="line">  <span class="keyword">private</span> Oauth2ClientAuthenticationMethodEntityRepository</span><br><span class="line">      oauth2ClientAuthenticationMethodEntityRepository;</span><br><span class="line">  <span class="keyword">private</span> Oauth2ClientGrantTypeEntityRepository oauth2ClientGrantTypeEntityRepository;</span><br><span class="line">  <span class="keyword">private</span> Oauth2ClientRedirectUriEntityRepository oauth2ClientRedirectUriEntityRepository;</span><br><span class="line">  <span class="keyword">private</span> Oauth2ClientScopeEntityRepository oauth2ClientScopeEntityRepository;</span><br><span class="line">  <span class="keyword">private</span> Oauth2ClientSettingEntityRepository oauth2ClientSettingEntityRepository;</span><br><span class="line">  <span class="keyword">private</span> ResourceScopeEntityRepository resourceScopeEntityRepository;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(RegisteredClient registeredClient)</span> &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;&gt;&gt; CustomRegisteredClientRepository.save registeredClient=&#123;&#125;&quot;</span>, registeredClient);</span><br><span class="line">    <span class="comment">// TODO need implement</span></span><br><span class="line">    log.debug(<span class="string">&quot;&lt;&lt; CustomRegisteredClientRepository.save &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Take this part of the Token process */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> RegisteredClient <span class="title function_">findById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;&gt;&gt; CustomRegisteredClientRepository.findById id=&#123;&#125;&quot;</span>, id);</span><br><span class="line">    Optional&lt;Oauth2ClientEntity&gt; oauth2ClientOptional = oauth2ClientEntityRepository.findById(id);</span><br><span class="line">    <span class="type">RegisteredClient</span> <span class="variable">registeredClient</span> <span class="operator">=</span> <span class="built_in">this</span>.getRegisteredClient(oauth2ClientOptional);</span><br><span class="line">    log.debug(<span class="string">&quot;&lt;&lt; CustomRegisteredClientRepository.findById registeredClient=&#123;&#125;&quot;</span>, registeredClient);</span><br><span class="line">    <span class="keyword">return</span> registeredClient;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** The authorization process will go through this */</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> RegisteredClient <span class="title function_">findByClientId</span><span class="params">(String clientId)</span> &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;&gt;&gt; CustomRegisteredClientRepository.findByClientId id=&#123;&#125;&quot;</span>, clientId);</span><br><span class="line">    Optional&lt;Oauth2ClientEntity&gt; oauth2ClientOptional =</span><br><span class="line">        oauth2ClientEntityRepository.findByClientId(clientId);</span><br><span class="line">    <span class="type">RegisteredClient</span> <span class="variable">registeredClient</span> <span class="operator">=</span> <span class="built_in">this</span>.getRegisteredClient(oauth2ClientOptional);</span><br><span class="line">    log.debug(</span><br><span class="line">        <span class="string">&quot;&lt;&lt; CustomRegisteredClientRepository.findByClientId registeredClient=&#123;&#125;&quot;</span>, registeredClient);</span><br><span class="line">    <span class="keyword">return</span> registeredClient;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> RegisteredClient <span class="title function_">getRegisteredClient</span><span class="params">(Optional&lt;Oauth2ClientEntity&gt; oauth2ClientOptional)</span> &#123;</span><br><span class="line">    oauth2ClientOptional.orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">BadCredentialsException</span>(<span class="string">&quot;Invalid client&quot;</span>));</span><br><span class="line">    <span class="type">Oauth2ClientEntity</span> <span class="variable">oauth2Client</span> <span class="operator">=</span> oauth2ClientOptional.get();</span><br><span class="line">    <span class="comment">// This is the association ID of the table</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">oauth2ClientId</span> <span class="operator">=</span> oauth2Client.getId();</span><br><span class="line">    <span class="comment">// Client account</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">clientId</span> <span class="operator">=</span> oauth2Client.getClientId();</span><br><span class="line"></span><br><span class="line">    List&lt;Oauth2ClientAuthenticationMethodEntity&gt; oauth2ClientAuthenticationMethods =</span><br><span class="line">        oauth2ClientAuthenticationMethodEntityRepository.findByOauth2ClientId(oauth2Client.getId());</span><br><span class="line">    List&lt;Oauth2ClientGrantTypeEntity&gt; oauth2ClientGrantTypes =</span><br><span class="line">        oauth2ClientGrantTypeEntityRepository.findByOauth2ClientId(oauth2Client.getId());</span><br><span class="line">    List&lt;Oauth2ClientRedirectUriEntity&gt; oauth2ClientRedirectUris =</span><br><span class="line">        oauth2ClientRedirectUriEntityRepository.findByOauth2ClientId(oauth2Client.getId());</span><br><span class="line">    List&lt;String&gt; redirectUris =</span><br><span class="line">        oauth2ClientRedirectUris.stream()</span><br><span class="line">            .map(Oauth2ClientRedirectUriEntity::getRedirectUri)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    List&lt;Oauth2ClientScopeEntity&gt; oauth2ClientScopes =</span><br><span class="line">        oauth2ClientScopeEntityRepository.findByOauth2ClientId(oauth2Client.getId());</span><br><span class="line">    List&lt;String&gt; authorityIds =</span><br><span class="line">        oauth2ClientScopes.stream()</span><br><span class="line">            .map(Oauth2ClientScopeEntity::getResourceScopeId)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    List&lt;String&gt; clientScopes =</span><br><span class="line">        resourceScopeEntityRepository.findByIdIn(authorityIds).stream()</span><br><span class="line">            .map(ResourceScopeEntity::getScope)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// @formatter:off</span></span><br><span class="line">    RegisteredClient.<span class="type">Builder</span> <span class="variable">builder</span> <span class="operator">=</span></span><br><span class="line">        RegisteredClient.withId(oauth2Client.getId())</span><br><span class="line">            .clientId(clientId)</span><br><span class="line">            .clientIdIssuedAt(</span><br><span class="line">                oauth2Client.getClientIdIssuedAt() != <span class="literal">null</span></span><br><span class="line">                    ? oauth2Client.getClientIdIssuedAt().toInstant(ZoneOffset.UTC)</span><br><span class="line">                    : <span class="literal">null</span>)</span><br><span class="line">            .clientSecret(oauth2Client.getClientSecret())</span><br><span class="line">            .clientSecretExpiresAt(</span><br><span class="line">                oauth2Client.getClientSecretExpiresAt() != <span class="literal">null</span></span><br><span class="line">                    ? oauth2Client.getClientSecretExpiresAt().toInstant(ZoneOffset.UTC)</span><br><span class="line">                    : <span class="literal">null</span>)</span><br><span class="line">            .clientName(oauth2Client.getClientName())</span><br><span class="line">            .clientAuthenticationMethods(</span><br><span class="line">                (authenticationMethods) -&gt;</span><br><span class="line">                    oauth2ClientAuthenticationMethods.forEach(</span><br><span class="line">                        authenticationMethod -&gt;</span><br><span class="line">                            authenticationMethods.add(</span><br><span class="line">                                resolveClientAuthenticationMethod(</span><br><span class="line">                                    authenticationMethod.getAuthenticationMethod()))))</span><br><span class="line">            .authorizationGrantTypes(</span><br><span class="line">                (grantTypes) -&gt;</span><br><span class="line">                    oauth2ClientGrantTypes.forEach(</span><br><span class="line">                        grantType -&gt;</span><br><span class="line">                            grantTypes.add(</span><br><span class="line">                                resolveAuthorizationGrantType(grantType.getGrantType()))))</span><br><span class="line">            .redirectUris((uris) -&gt; uris.addAll(redirectUris))</span><br><span class="line">            .scopes((scopes) -&gt; scopes.addAll(clientScopes));</span><br><span class="line">    <span class="comment">// @formatter:on</span></span><br><span class="line">    <span class="type">Oauth2ClientSettingEntity</span> <span class="variable">requireProofKey</span> <span class="operator">=</span></span><br><span class="line">        <span class="built_in">this</span>.findClientSetting(</span><br><span class="line">            oauth2ClientId,</span><br><span class="line">            OAuthSettingNames.Client.TYPE,</span><br><span class="line">            OAuthSettingNames.Client.Property.REQUIRE_PROOF_KEY);</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="type">Oauth2ClientSettingEntity</span> <span class="variable">requireAuthorizationConsent</span> <span class="operator">=</span></span><br><span class="line">        <span class="built_in">this</span>.findClientSetting(</span><br><span class="line">            oauth2ClientId,</span><br><span class="line">            OAuthSettingNames.Client.TYPE,</span><br><span class="line">            OAuthSettingNames.Client.Property.REQUIRE_AUTHORIZATION_CONSENT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="type">ClientSettings</span> <span class="variable">clientSettings</span> <span class="operator">=</span></span><br><span class="line">        ClientSettings.builder()</span><br><span class="line">            .requireProofKey(Boolean.valueOf(requireProofKey.getPropertyValue()))</span><br><span class="line">            .requireAuthorizationConsent(</span><br><span class="line">                Boolean.valueOf(requireAuthorizationConsent.getPropertyValue()))</span><br><span class="line">            .build();</span><br><span class="line">    log.debug(<span class="string">&quot;clientSettings=&#123;&#125;&quot;</span>, clientSettings);</span><br><span class="line">    builder.clientSettings(clientSettings);</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="type">Oauth2ClientSettingEntity</span> <span class="variable">idTokenSignatureAlgorithm</span> <span class="operator">=</span></span><br><span class="line">        <span class="built_in">this</span>.findClientSetting(</span><br><span class="line">            oauth2ClientId,</span><br><span class="line">            OAuthSettingNames.Token.TYPE,</span><br><span class="line">            OAuthSettingNames.Token.Property.ID_TOKEN_SIGNATURE_ALGORITHM);</span><br><span class="line">    <span class="type">Oauth2ClientSettingEntity</span> <span class="variable">accessTokenTimeToLive</span> <span class="operator">=</span></span><br><span class="line">        <span class="built_in">this</span>.findClientSetting(</span><br><span class="line">            oauth2ClientId,</span><br><span class="line">            OAuthSettingNames.Token.TYPE,</span><br><span class="line">            OAuthSettingNames.Token.Property.ACCESS_TOKEN_TIME_TO_LIVE);</span><br><span class="line">    <span class="type">Oauth2ClientSettingEntity</span> <span class="variable">refreshTokenTimeToLive</span> <span class="operator">=</span></span><br><span class="line">        <span class="built_in">this</span>.findClientSetting(</span><br><span class="line">            oauth2ClientId,</span><br><span class="line">            OAuthSettingNames.Token.TYPE,</span><br><span class="line">            OAuthSettingNames.Token.Property.PREFRESH_TOKEN_TIME_TO_LIVE);</span><br><span class="line">    <span class="type">Oauth2ClientSettingEntity</span> <span class="variable">reuseRefreshTokens</span> <span class="operator">=</span></span><br><span class="line">        <span class="built_in">this</span>.findClientSetting(</span><br><span class="line">            oauth2ClientId,</span><br><span class="line">            OAuthSettingNames.Token.TYPE,</span><br><span class="line">            OAuthSettingNames.Token.Property.REUSE_REFRESH_TOKENS);</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="type">TokenSettings</span> <span class="variable">tokenSettings</span> <span class="operator">=</span></span><br><span class="line">        TokenSettings.builder()</span><br><span class="line">            .accessTokenTimeToLive(</span><br><span class="line">                Duration.ofSeconds(Integer.valueOf(accessTokenTimeToLive.getPropertyValue())))</span><br><span class="line">            .reuseRefreshTokens(Boolean.valueOf(reuseRefreshTokens.getPropertyValue()))</span><br><span class="line">            .refreshTokenTimeToLive(</span><br><span class="line">                Duration.ofSeconds(Integer.valueOf(refreshTokenTimeToLive.getPropertyValue())))</span><br><span class="line">            .idTokenSignatureAlgorithm(</span><br><span class="line">                SignatureAlgorithm.from(idTokenSignatureAlgorithm.getPropertyValue()))</span><br><span class="line">            .build();</span><br><span class="line">    log.debug(<span class="string">&quot;tokenSettings=&#123;&#125;&quot;</span>, tokenSettings);</span><br><span class="line">    builder.tokenSettings(tokenSettings);</span><br><span class="line"></span><br><span class="line">    <span class="type">RegisteredClient</span> <span class="variable">registeredClient</span> <span class="operator">=</span> builder.build();</span><br><span class="line">    <span class="keyword">return</span> registeredClient;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Oauth2ClientSettingEntity <span class="title function_">findClientSetting</span><span class="params">(</span></span><br><span class="line"><span class="params">      String oauth2ClientId, String propertyType, String propertyName)</span> &#123;</span><br><span class="line">    Optional&lt;Oauth2ClientSettingEntity&gt; oauth2ClientSettingOptional =</span><br><span class="line">        oauth2ClientSettingEntityRepository.findByOauth2ClientIdAndPropertyTypeAndPropertyName(</span><br><span class="line">            oauth2ClientId, propertyType, propertyName);</span><br><span class="line">    oauth2ClientSettingOptional.orElseThrow(</span><br><span class="line">        () -&gt;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">BadCredentialsException</span>(</span><br><span class="line">                String.format(</span><br><span class="line">                    <span class="string">&quot;Invalid client setting %s %s %s&quot;</span>,</span><br><span class="line">                    oauth2ClientId, propertyType, propertyName)));</span><br><span class="line">    <span class="keyword">return</span> oauth2ClientSettingOptional.get();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> ClientAuthenticationMethod <span class="title function_">resolveClientAuthenticationMethod</span><span class="params">(</span></span><br><span class="line"><span class="params">      String clientAuthenticationMethod)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ClientAuthenticationMethod.CLIENT_SECRET_BASIC</span><br><span class="line">        .getValue()</span><br><span class="line">        .equals(clientAuthenticationMethod)) &#123;</span><br><span class="line">      <span class="keyword">return</span> ClientAuthenticationMethod.CLIENT_SECRET_BASIC;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ClientAuthenticationMethod.CLIENT_SECRET_POST</span><br><span class="line">        .getValue()</span><br><span class="line">        .equals(clientAuthenticationMethod)) &#123;</span><br><span class="line">      <span class="keyword">return</span> ClientAuthenticationMethod.CLIENT_SECRET_POST;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ClientAuthenticationMethod.NONE.getValue().equals(clientAuthenticationMethod)) &#123;</span><br><span class="line">      <span class="keyword">return</span> ClientAuthenticationMethod.NONE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ClientAuthenticationMethod</span>(</span><br><span class="line">        clientAuthenticationMethod); <span class="comment">// Custom client authentication method</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> AuthorizationGrantType <span class="title function_">resolveAuthorizationGrantType</span><span class="params">(</span></span><br><span class="line"><span class="params">      String authorizationGrantType)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (AuthorizationGrantType.AUTHORIZATION_CODE.getValue().equals(authorizationGrantType)) &#123;</span><br><span class="line">      <span class="keyword">return</span> AuthorizationGrantType.AUTHORIZATION_CODE;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (AuthorizationGrantType.CLIENT_CREDENTIALS</span><br><span class="line">        .getValue()</span><br><span class="line">        .equals(authorizationGrantType)) &#123;</span><br><span class="line">      <span class="keyword">return</span> AuthorizationGrantType.CLIENT_CREDENTIALS;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (AuthorizationGrantType.REFRESH_TOKEN.getValue().equals(authorizationGrantType)) &#123;</span><br><span class="line">      <span class="keyword">return</span> AuthorizationGrantType.REFRESH_TOKEN;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthorizationGrantType</span>(authorizationGrantType); <span class="comment">// Custom authorization grant type</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OAuth2AuthorizationService"><a href="#OAuth2AuthorizationService" class="headerlink" title="OAuth2AuthorizationService"></a>OAuth2AuthorizationService</h3><p>If you adjust the <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-authorization-server/blob/main/oauth2-authorization-server/src/main/resources/org/springframework/security/oauth2/server/authorization/oauth2-authorization-schema.sql">oauth2_authorization</a> form like me, you may also need to customize your own OAuth2AuthorizationService, but my example doesn’t change much except to change the <code>blob</code> field to <code>text</code>, for specific implementation, please refer to this <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-authorization-server/blob/main/oauth2-authorization-server/src/main/java/org/springframework/security/oauth2/server/authorization/JdbcOAuth2AuthorizationService.java">JdbcOAuth2AuthorizationService.java</a>.  </p>
<h3 id="OAuth2TokenCustomizer"><a href="#OAuth2TokenCustomizer" class="headerlink" title="OAuth2TokenCustomizer"></a>OAuth2TokenCustomizer</h3><p>Finally, if there is a customized requirement in the JWT Token, you can add the required information here.  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.security.oauth2.server.authorization.JwtEncodingContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.oauth2.server.authorization.OAuth2TokenCustomizer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomOAuth2Token</span> <span class="keyword">implements</span> <span class="title class_">OAuth2TokenCustomizer</span>&lt;JwtEncodingContext&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(JwtEncodingContext context)</span> &#123;</span><br><span class="line">    context.getClaims().id(UUID.randomUUID().toString()); <span class="comment">// jti</span></span><br><span class="line">    log.debug(<span class="string">&quot;&lt;&lt; Customizer.customize JwtEncodingContext=&#123;&#125;&quot;</span>, context);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><p>The required components are ready, and then start to assemble.  </p>
<h3 id="Generate-RSA-Key"><a href="#Generate-RSA-Key" class="headerlink" title="Generate RSA Key"></a>Generate RSA Key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genpkey -algorithm RSA -pkeyopt rsa_keygen_bits:2048 -out key.pem</span><br></pre></td></tr></table></figure>

<p>algorithm: Using RSA algorithm<br>pkeyopt: The key length is 2048<br>out: Export as pem file  </p>
<p>Then put key.pem to <code>$&#123;rootDir&#125;/key/key.pem</code>  </p>
<h3 id="AuthorizationServerConfig"><a href="#AuthorizationServerConfig" class="headerlink" title="AuthorizationServerConfig"></a>AuthorizationServerConfig</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizationServerConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Value(&quot;$&#123;authserver.key-path&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> File pprivateKeyFile;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Value(&quot;$&#123;authserver.issuer&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String issuer;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Default Ebdpoints</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * &lt;p&gt;</span></span><br><span class="line"><span class="comment">   * Authorization /oauth2/authorize Token Endpoint /oauth2/token Token Revocation</span></span><br><span class="line"><span class="comment">   * /oauth2/revoke Token Introspection /oauth2/introspect JWK Set Ecdpoint</span></span><br><span class="line"><span class="comment">   * /oauth2/jwks Authorization Server Metadata</span></span><br><span class="line"><span class="comment">   * /.well-known/oauth-authorization-server OIDC Provider Configuration</span></span><br><span class="line"><span class="comment">   * /.well-known/openid-configuration</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@Order(Ordered.HIGHEST_PRECEDENCE)</span></span><br><span class="line">  <span class="keyword">public</span> SecurityFilterChain <span class="title function_">authorizationServerSecurityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// Original page</span></span><br><span class="line">    OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);</span><br><span class="line">    <span class="keyword">return</span> http.formLogin(Customizer.withDefaults()).build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> RegisteredClientRepository <span class="title function_">registeredClientRepository</span><span class="params">(</span></span><br><span class="line"><span class="params">      Oauth2ClientEntityRepository oauth2ClientEntityRepository,</span></span><br><span class="line"><span class="params">      Oauth2ClientAuthenticationMethodEntityRepository oauth2ClientAuthenticationMethodEntityRepository,</span></span><br><span class="line"><span class="params">      Oauth2ClientGrantTypeEntityRepository oauth2ClientGrantTypeRepository,</span></span><br><span class="line"><span class="params">      Oauth2ClientRedirectUriEntityRepository oauth2ClientRedirectUriRepository,</span></span><br><span class="line"><span class="params">      Oauth2ClientScopeEntityRepository oauth2ClientScopeRepository,</span></span><br><span class="line"><span class="params">      Oauth2ClientSettingEntityRepository oauth2ClientSettingRepository,</span></span><br><span class="line"><span class="params">      ResourceScopeEntityRepository resourceScopeRepository)</span> &#123;</span><br><span class="line">    <span class="type">RegisteredClientRepository</span> <span class="variable">registeredClientRepository</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomRegisteredClientRepository</span>(</span><br><span class="line">        oauth2ClientEntityRepository, oauth2ClientAuthenticationMethodEntityRepository, oauth2ClientGrantTypeRepository,</span><br><span class="line">        oauth2ClientRedirectUriRepository, oauth2ClientScopeRepository, oauth2ClientSettingRepository,</span><br><span class="line">        resourceScopeRepository);</span><br><span class="line">    <span class="keyword">return</span> registeredClientRepository;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> OAuth2TokenCustomizer&lt;JwtEncodingContext&gt; <span class="title function_">oauth2TokenCustomizer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomOAuth2Token</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> UserDetailsService <span class="title function_">userDetailsService</span><span class="params">(UserAccountEntityRepository userAccountRepository,</span></span><br><span class="line"><span class="params">      UserGroupMemberEntityRepository userGroupMemberRepository, UserGroupEntityRepository userGroupRepository)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomUserDetailsService</span>(userAccountRepository, userGroupMemberRepository, userGroupRepository);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> AbstractUserDetailsAuthenticationProvider <span class="title function_">abstractUserDetailsAuthenticationProvider</span><span class="params">(</span></span><br><span class="line"><span class="params">      UserDetailsService userDetailsService, PasswordEncoder passwordEncoder)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomUserDetailsAuthenticationProvider</span>(userDetailsService, passwordEncoder);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> OAuth2AuthorizationService <span class="title function_">authorizationService</span><span class="params">(</span></span><br><span class="line"><span class="params">      Oauth2AuthorizationEntityRepository oauth2AuthorizationEntityRepository,</span></span><br><span class="line"><span class="params">      RegisteredClientRepository registeredClientRepository)</span> &#123;</span><br><span class="line">    <span class="type">OAuth2AuthorizationService</span> <span class="variable">OAuth2AuthorizationService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CustomOAuth2AuthorizationService</span>(</span><br><span class="line">        oauth2AuthorizationEntityRepository, registeredClientRepository);</span><br><span class="line">    <span class="keyword">return</span> OAuth2AuthorizationService;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> OAuth2AuthorizationConsentService <span class="title function_">authorizationConsentService</span><span class="params">(JdbcTemplate jdbcTemplate,</span></span><br><span class="line"><span class="params">      RegisteredClientRepository registeredClientRepository)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JdbcOAuth2AuthorizationConsentService</span>(jdbcTemplate, registeredClientRepository);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> JWKSource&lt;SecurityContext&gt; <span class="title function_">jwkSource</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">pemEncodedRSAPrivateKey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Files.readAllBytes(pprivateKeyFile.toPath()), StandardCharsets.UTF_8);</span><br><span class="line">    <span class="type">JWK</span> <span class="variable">jwk</span> <span class="operator">=</span> JWK.parseFromPEMEncodedObjects(pemEncodedRSAPrivateKey);</span><br><span class="line">    <span class="type">JWKSet</span> <span class="variable">jwkSet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JWKSet</span>(jwk);</span><br><span class="line">    <span class="keyword">return</span> (jwkSelector, securityContext) -&gt; jwkSelector.select(jwkSet);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> ProviderSettings <span class="title function_">providerSettings</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ProviderSettings.builder().issuer(issuer).build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="DefaultSecurityConfig"><a href="#DefaultSecurityConfig" class="headerlink" title="DefaultSecurityConfig"></a>DefaultSecurityConfig</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSecurityConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// @formatter:off</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  SecurityFilterChain <span class="title function_">defaultSecurityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http</span><br><span class="line">      .authorizeRequests(authorizeRequests -&gt;</span><br><span class="line">        authorizeRequests.anyRequest().authenticated()</span><br><span class="line">      )</span><br><span class="line">      .formLogin(org.springframework.security.config.Customizer.withDefaults());</span><br><span class="line">    <span class="keyword">return</span> http.build();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// @formatter:on</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><p>At this point, you can perform a login test. Here you will see the login default page. Later on the page will tell you how to customize it. First, we will test whether the function is normal.  </p>
<h3 id="Get-public-key"><a href="#Get-public-key" class="headerlink" title="Get public key"></a>Get public key</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --request GET <span class="string">&#x27;http://localhost:8080/oauth2/jwks&#x27;</span></span><br></pre></td></tr></table></figure>

<p>OAuth server response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;keys&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;kty&quot;</span><span class="punctuation">:</span> <span class="string">&quot;RSA&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;e&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AQAB&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;n&quot;</span><span class="punctuation">:</span> <span class="string">&quot;n0mpjdlzz__bg8hlJH7ktuTuDPgmCPUQauf00Kd3dGKz9Kr26hqITRQV2POmrHemzpkenO-LP1BasDTgaIfil-tLP6djLDzk8PTEiroviCAo0IGsDrClVXl91M-5Yvl5sStHVO4oDgSbBCNR52jvLr2FjPe4qVL0fqWMwPEKU8RQifrNfGvPufJKB6cXRiSEBJQ9UOIhaZrL51pevM5oQo4TTmuuzaDfHEEZneXyo1HvSvYNKBwR3mWkeFTFdfMYfPvM7cASVS0sEnSO5TUUNyO7OIyus0Ve8Z8Cz8NwkAkjt8c0-J4FBlQ5_7PHKFknSZZ6F_xdzHM9J5_q2EtWXw&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Use-OpenID-Connect-debugger-to-test"><a href="#Use-OpenID-Connect-debugger-to-test" class="headerlink" title="Use OpenID Connect debugger to test"></a>Use OpenID Connect debugger to test</h3><p>Open the <a target="_blank" rel="noopener" href="https://oidcdebugger.com/">OpenID Connect debugger</a> website and enter the following test data.  </p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
<th>Desc</th>
</tr>
</thead>
<tbody><tr>
<td>Authorize URI (required)</td>
<td><a target="_blank" rel="noopener" href="http://localhost:8080/oauth2/authorize">http://localhost:8080/oauth2/authorize</a></td>
<td>-</td>
</tr>
<tr>
<td>Redirect URI (required)</td>
<td><a target="_blank" rel="noopener" href="https://oidcdebugger.com/debug">https://oidcdebugger.com/debug</a></td>
<td>-</td>
</tr>
<tr>
<td>Client ID (required)</td>
<td>democlient</td>
<td>-</td>
</tr>
<tr>
<td>Scope (required)</td>
<td>openid</td>
<td>-</td>
</tr>
<tr>
<td>State (optional)</td>
<td>None</td>
<td>Optional value, carried through the entire process and returned to the client</td>
</tr>
<tr>
<td>Nonce (optional)</td>
<td>None</td>
<td>A random number (or a number used once) is a random value used to prevent replay attacks</td>
</tr>
<tr>
<td>Response type (required)</td>
<td>code</td>
<td>Reply with authorization code</td>
</tr>
<tr>
<td>Response mode (required)</td>
<td>form_post</td>
<td>Use Form Post to Redirect URI</td>
</tr>
</tbody></table>
<p>copy url like this and paste it in the browser address bar.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/oauth2/authorize</span><br><span class="line">?client_id=democlient</span><br><span class="line">&amp;redirect_uri=https://oidcdebugger.com/debug</span><br><span class="line">&amp;scope=openid</span><br><span class="line">&amp;response_type=code</span><br><span class="line">&amp;response_mode=form_post</span><br><span class="line">&amp;nonce=6wvhzv2kwmf</span><br></pre></td></tr></table></figure>

<p>Then you will see the login screen<br><img src="https://i.imgur.com/pi7ldhi.png" alt="login page"></p>
<p>input username <code>admin</code> and password <code>1234</code> to login, then it will be redirect back to <code>https://oidcdebugger.com/debug</code>, if successful you can get authorization code</p>
<p><img src="https://i.imgur.com/6dVgsu2.png" alt="oidcdebugger"></p>
<p>Then you can use the authorization code to exchange for jwt token.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl --location --request POST <span class="string">&#x27;localhost:8080/oauth2/token&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/x-www-form-urlencoded&#x27;</span> \</span><br><span class="line">--data-urlencode <span class="string">&#x27;grant_type=authorization_code&#x27;</span> \</span><br><span class="line">--data-urlencode <span class="string">&#x27;code=kWRApivv3DjoZOLamU5UlKV3T-U2eqrjQPfWMY9qzKO-EMPcMI-VMRuJbqZm3maNh1q09lePlAIFeuSPVwAMrnFvStJNec3IlwAMkS39J_jFthuZqFTjQCrBF12xft3F&#x27;</span> \</span><br><span class="line">--data-urlencode <span class="string">&#x27;client_id=democlient&#x27;</span> \</span><br><span class="line">--data-urlencode <span class="string">&#x27;client_secret=123456&#x27;</span> \</span><br><span class="line">--data-urlencode <span class="string">&#x27;redirect_uri=https://oidcdebugger.com/debug&#x27;</span></span><br></pre></td></tr></table></figure>

<p>OAuth server response</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;access_token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImF1ZCI6ImRlbW9jbGllbnQiLCJuYmYiOjE2MzUyMzUxODMsInNjb3BlIjpbIm9wZW5pZCJdLCJpc3MiOiJodHRwOlwvXC9hdXRoLXNlcnZlcjo4MDgwIiwiZXhwIjoxNjM1MjM1NDgzLCJpYXQiOjE2MzUyMzUxODMsImp0aSI6ImNmNDgxNjBjLWU1MDItNDI4ZC05YmIxLTljNmU5OGRjNjc4MyJ9.DR2dj-j7zUmPHKqvicAbRRd2GTWSRTVNYPdGoOtnApB03bcszoEKF9PxfWRGlEgjNi28_d4oPpiQTRo5rnQoa1RY79Ff27fO_Y08uvP6a4GZQGT_XlbymxC2xjg74wtYsyR7ea2TSahM0KJfKohI35I0d92yOQ5WtCEBkKPRuTAagIHkTzw_pzwZeCLqWS82NaAlCrNOhg_zuJzt0iKnDM7LmvWbMiEAGcAIq6NnLc6pShIa49tyHE0W3NFgtRgt_oavatMxn9QPCurgGTSXyZv_Cj0t-qKz2NldlSHftdfEENWSFNIwEUs3pkQnrDYfgFWRdJjpctjAQQk0UfyGFw&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;refresh_token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qknzEz6eTOwtJVusUUOLohRE_rD_y5_fI4NAR42--p16_6UthANcNTrcNr_6w3QTbxkiz1saXNdtxrWu_cj3LiZjZEaGfk-0rmyAAMrHcQWoheTL6PRvvPs6CFQtDJLk&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scope&quot;</span><span class="punctuation">:</span> <span class="string">&quot;openid&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id_token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImF1ZCI6ImRlbW9jbGllbnQiLCJhenAiOiJkZW1vY2xpZW50IiwiaXNzIjoiaHR0cDpcL1wvYXV0aC1zZXJ2ZXI6ODA4MCIsImV4cCI6MTYzNTIzNjk4MywiaWF0IjoxNjM1MjM1MTgzLCJub25jZSI6IjZ3dmh6djJrd21mIiwianRpIjoiMmY0ZDhjZmUtZDA1Yi00YTk1LTkxMjItMDhiNTgyZjU1N2FkIn0.TpzMB7jsBsXLU8wiwc6zh8R507A_7ta1o5uZ99myOhzwcpv2uhGie2860FBYeyDJ15I2xandYktT-yCaAx-SbpyxXnhHH8ZhkpCrYwfMGDOapFQpfm1RfamQ10P2TpNNnfwfGSUOEOcGtzMzQpgZXdkO7flcRwEle8EmE-xxcpCUqCBpOrId75Y9C0OhmCPnY4JmZMt3jP27xBWemetl6Fo5jSMytR7RJwMT7xbXHhKl3CIM8QSyiiES8ARM_HTbTJHOsLqsQX5KXHnvXyxCP0SNNMV55fKnyTrr4XqgfHccinr3QSVw2wcWwhxNs3uUsJQTadgfZxcEmUb-tQrbFQ&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;token_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bearer&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;expires_in&quot;</span><span class="punctuation">:</span> <span class="number">299</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Test-client-credentials"><a href="#Test-client-credentials" class="headerlink" title="Test client credentials"></a>Test client credentials</h3><p>This mode is used in Server-Server, without User participation.  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl --request POST <span class="string">&#x27;35.194.246.111/oauth2/token&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Authorization: Basic ZGVtb2NsaWVudDoxMjM0NTY=&#x27;</span> \</span><br><span class="line">--header <span class="string">&#x27;Content-Type: application/x-www-form-urlencoded&#x27;</span> \</span><br><span class="line">--data-urlencode <span class="string">&#x27;grant_type=client_credentials&#x27;</span></span><br></pre></td></tr></table></figure>

<p>OAuth server 回覆</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;access_token&quot;</span>: <span class="string">&quot;eyJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJkZW1vY2xpZW50IiwiYXVkIjoiZGVtb2NsaWVudCIsIm5iZiI6MTYzMzk1NzkzNCwic2NvcGUiOlsib3BlbmlkIiwicHJvZmlsZSJdLCJpc3MiOiJodHRwOlwvXC9hdXRoLXNlcnZlcjo4MDgwIiwiZXhwIjoxNjMzOTU4MjM0LCJpYXQiOjE2MzM5NTc5MzR9.ZKxy6Pz8Mx8AgU0hVsPo8jAwCk9jlgAx0sS_ao_cXLs5DnRU-VlzyrB9nUuTxUZJn4dbv9KPzP-ZnotBth2RJ6uhClMpJMq4hyNo_2Yu1LlE9O-tkn4b3UnKptpqroc34PWhg_SY-aa_7Y8M33kKOZeSdUxKYVQzr09-P0IVnIa1ENXUuGrxqCENW-sOMaobnW1AOqjvRPq4p5Ei2OiU6NJocxfYpaGXiLPizSt2LIAfRGYGt2U8PlfprnM9py7_QnW-K37-MhCiAtxuss69o4xVHZdheuheQaKFpBHiyi92nXhDKnZmC54ZBLAPQDN9MMSQBVeKO3JTnN3IhNbPGA&quot;</span>,</span><br><span class="line">    <span class="string">&quot;scope&quot;</span>: <span class="string">&quot;openid&quot;</span>,</span><br><span class="line">    <span class="string">&quot;token_type&quot;</span>: <span class="string">&quot;Bearer&quot;</span>,</span><br><span class="line">    <span class="string">&quot;expires_in&quot;</span>: 299</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Customized-page"><a href="#Customized-page" class="headerlink" title="Customized page"></a>Customized page</h2><p>If you have a custom page requirement, please refer to the next steps.</p>
<p>add dependencies</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;org.springframework.boot:spring-boot-starter-thymeleaf&#x27;</span></span><br><span class="line">implementation <span class="string">&#x27;org.thymeleaf.extras:thymeleaf-extras-springsecurity5&#x27;</span></span><br></pre></td></tr></table></figure>

<p>add controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/login&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getLoginPage</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>add page, there is not much customization here, only add a banner image to test.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Please Log In<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">integrity</span>=<span class="string">&quot;sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://getbootstrap.com/docs/4.0/examples/signin/signin.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-10 col-lg-4 col-xl-4 mx-auto text-center&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/images/banner.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;carousel-inner img-responsive img-rounded&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;form-signin&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/login&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;form-signin-heading&quot;</span>&gt;</span>Please Log In<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;param.error&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;alert alert-danger&quot;</span> <span class="attr">role</span>=<span class="string">&quot;alert&quot;</span>&gt;</span>wrong user name or password<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;param.logout&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;alert alert-success&quot;</span> <span class="attr">role</span>=<span class="string">&quot;alert&quot;</span>&gt;</span>you are logged out<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;輸入帳號&quot;</span> <span class="attr">required</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">autofocus</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;輸入密碼&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-lg btn-primary btn-block&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>login<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>DefaultSecurityConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSecurityConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// @formatter:off</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  SecurityFilterChain <span class="title function_">defaultSecurityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/images/*&quot;</span>)</span><br><span class="line">        .permitAll()</span><br><span class="line">        .and()</span><br><span class="line">        .formLogin()</span><br><span class="line">        .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">        .permitAll()</span><br><span class="line">        .and()</span><br><span class="line">        .logout()</span><br><span class="line">        .permitAll()</span><br><span class="line">        .and()</span><br><span class="line">        .authorizeRequests(authorizeRequests -&gt; authorizeRequests.anyRequest().authenticated());</span><br><span class="line">    <span class="keyword">return</span> http.build();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// @formatter:on</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then try to log in again, now we are using our own login page.<br><img src="https://i.imgur.com/RSu2hCf.png" alt="Customized login page"></p>
<h3 id="Consent-page"><a href="#Consent-page" class="headerlink" title="Consent page"></a>Consent page</h3><p>When you provide an external Client to access your user information, you will usually provide a consent page for users to confirm. Here is also how to customize the consent page.  </p>
<p>add AuthorizationConsentController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@author</span> Daniel Garnier-Moiroux */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizationConsentController</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> RegisteredClientRepository registeredClientRepository;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> OAuth2AuthorizationConsentService authorizationConsentService;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> ScopeAssembler scopeAssembler;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(value = &quot;/oauth2/consent&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">consent</span><span class="params">(</span></span><br><span class="line"><span class="params">      Principal principal,</span></span><br><span class="line"><span class="params">      Model model,</span></span><br><span class="line"><span class="params">      <span class="meta">@RequestParam(OAuth2ParameterNames.CLIENT_ID)</span> String clientId,</span></span><br><span class="line"><span class="params">      <span class="meta">@RequestParam(OAuth2ParameterNames.SCOPE)</span> String scope,</span></span><br><span class="line"><span class="params">      <span class="meta">@RequestParam(OAuth2ParameterNames.STATE)</span> String state)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove scopes that were already approved</span></span><br><span class="line">    Set&lt;String&gt; scopesToApprove = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    Set&lt;String&gt; previouslyApprovedScopes = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="type">RegisteredClient</span> <span class="variable">registeredClient</span> <span class="operator">=</span> <span class="built_in">this</span>.registeredClientRepository.findByClientId(clientId);</span><br><span class="line">    <span class="type">OAuth2AuthorizationConsent</span> <span class="variable">currentAuthorizationConsent</span> <span class="operator">=</span></span><br><span class="line">        <span class="built_in">this</span>.authorizationConsentService.findById(registeredClient.getId(), principal.getName());</span><br><span class="line">    Set&lt;String&gt; authorizedScopes;</span><br><span class="line">    <span class="keyword">if</span> (currentAuthorizationConsent != <span class="literal">null</span>) &#123;</span><br><span class="line">      authorizedScopes = currentAuthorizationConsent.getScopes();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      authorizedScopes = Collections.emptySet();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (String requestedScope : StringUtils.delimitedListToStringArray(scope, <span class="string">&quot; &quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (authorizedScopes.contains(requestedScope)) &#123;</span><br><span class="line">        previouslyApprovedScopes.add(requestedScope);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        scopesToApprove.add(requestedScope);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    model.addAttribute(<span class="string">&quot;clientId&quot;</span>, clientId);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;state&quot;</span>, state);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;scopes&quot;</span>, withDescription(scopesToApprove));</span><br><span class="line">    model.addAttribute(<span class="string">&quot;previouslyApprovedScopes&quot;</span>, withDescription(previouslyApprovedScopes));</span><br><span class="line">    model.addAttribute(<span class="string">&quot;principalName&quot;</span>, principal.getName());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;consent&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Set&lt;ScopeWithDescription&gt; <span class="title function_">withDescription</span><span class="params">(Set&lt;String&gt; scopes)</span> &#123;</span><br><span class="line">    Set&lt;ScopeWithDescription&gt; scopeWithDescriptions = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String scope : scopes) &#123;</span><br><span class="line"></span><br><span class="line">      scopeWithDescriptions.add(scopeAssembler.scopeToScopeWithDescription(scope));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> scopeWithDescriptions;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>add src&#x2F;main&#x2F;resources&#x2F;templates&#x2F;consent.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">integrity</span>=<span class="string">&quot;sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Custom consent page - Consent required<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: aliceblue;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">cancelConsent</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="property">consent_form</span>.<span class="title function_">reset</span>();</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="property">consent_form</span>.<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-10 col-lg-4 col-xl-4 mx-auto text-center&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/images/consent.jpg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;carousel-inner img-responsive img-rounded&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col text-center&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    The application</span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;font-weight-bold text-primary&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;clientId&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    wants to access your account</span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;font-weight-bold&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;principalName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row pb-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col text-center&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span>The following permissions are requested by the above app.<span class="tag">&lt;<span class="name">br</span> /&gt;</span>Please review</span><br><span class="line">                    these and consent if you approve.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col text-center&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">&quot;consent_form&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/oauth2/authorize&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;client_id&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;clientId&#125;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;state&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;state&#125;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;scope: $&#123;scopes&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-group form-check py-1&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-check-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;scope&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;scope.scope&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">th:id</span>=<span class="string">&quot;$&#123;scope.scope&#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-check-label font-weight-bold&quot;</span> <span class="attr">th:for</span>=<span class="string">&quot;$&#123;scope.scope&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">th:text</span>=<span class="string">&quot;$&#123;scope.scope&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;text-primary&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;scope.description&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #lists.isEmpty(previouslyApprovedScopes)&#125;&quot;</span>&gt;</span>You have already granted the following</span><br><span class="line">                        permissions to the above app:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:each</span>=<span class="string">&quot;scope: $&#123;previouslyApprovedScopes&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-group form-check py-1&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-check-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">th:id</span>=<span class="string">&quot;$&#123;scope.scope&#125;&quot;</span> <span class="attr">disabled</span> <span class="attr">checked</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;form-check-label font-weight-bold&quot;</span> <span class="attr">th:for</span>=<span class="string">&quot;$&#123;scope.scope&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">th:text</span>=<span class="string">&quot;$&#123;scope.scope&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;text-primary&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;scope.description&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group pt-3&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary btn-lg&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">id</span>=<span class="string">&quot;submit-consent&quot;</span>&gt;</span></span><br><span class="line">                            Submit Consent</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-link regular&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;cancel-consent&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">onclick</span>=<span class="string">&quot;cancelConsent();&quot;</span>&gt;</span></span><br><span class="line">                            Cancel</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row pt-4&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col text-center&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">small</span>&gt;</span></span><br><span class="line">                        Your consent to provide access is required.</span><br><span class="line">                        <span class="tag">&lt;<span class="name">br</span> /&gt;</span>If you do not approve, click Cancel, in which case no information will be shared with the</span><br><span class="line">                        app.</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Adjust AuthorizationServerConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorizationServerConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CUSTOM_CONSENT_PAGE_URI</span> <span class="operator">=</span> <span class="string">&quot;/oauth2/consent&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@Order(Ordered.HIGHEST_PRECEDENCE)</span></span><br><span class="line">  <span class="keyword">public</span> SecurityFilterChain <span class="title function_">authorizationServerSecurityFilterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    OAuth2AuthorizationServerConfigurer&lt;HttpSecurity&gt; authorizationServerConfigurer = <span class="keyword">new</span> <span class="title class_">OAuth2AuthorizationServerConfigurer</span>&lt;&gt;();</span><br><span class="line">    authorizationServerConfigurer</span><br><span class="line">        .authorizationEndpoint(authorizationEndpoint -&gt; authorizationEndpoint.consentPage(CUSTOM_CONSENT_PAGE_URI));</span><br><span class="line"></span><br><span class="line">    <span class="type">RequestMatcher</span> <span class="variable">endpointsMatcher</span> <span class="operator">=</span> authorizationServerConfigurer.getEndpointsMatcher();</span><br><span class="line"></span><br><span class="line">    http.requestMatcher(endpointsMatcher)</span><br><span class="line">        .authorizeRequests(authorizeRequests -&gt; authorizeRequests.anyRequest().authenticated())</span><br><span class="line">        .csrf(csrf -&gt; csrf.ignoringRequestMatchers(endpointsMatcher)).apply(authorizationServerConfigurer);</span><br><span class="line">    <span class="keyword">return</span> http.formLogin(Customizer.withDefaults()).build();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Because openid is defined by default without the user’s consent, the consent screen will appear when we add a profile to our Scope.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/oauth2/authorize?client_id=democlient&amp;redirect_uri=https%3A%2F%2Foidcdebugger.com%2Fdebug&amp;scope=openid%20profile&amp;response_type=code&amp;response_mode=form_post&amp;nonce=6wvhzv2kwmf</span><br></pre></td></tr></table></figure>

<p>After successful login<br><img src="https://i.imgur.com/uQd40aM.png" alt="consent page"></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>In this way, most of the needs that need to be customized can be completed. Thank you for reading patiently. If you need to refer to the code, please go to <a target="_blank" rel="noopener" href="https://github.com/samzhu/getting-started-spring-authorization-server">github.com&#x2F;samzhu&#x2F;getting-started-spring-authorization-server</a>, reminder, this code is not complete, it is just used to demo how to customize.</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>Sam Zhu
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://blog.samzhu.dev/2021/10/26/Getting-Started-Spring-Authorization-Server/" title="Getting Started Spring Authorization Server">https://blog.samzhu.dev/2021/10/26/Getting-Started-Spring-Authorization-Server/</a>
  </li>
  <li class="post-copyright-license">
      <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Spring/" rel="tag"># Spring</a>
              <a href="/tags/OAuth/" rel="tag"># OAuth</a>
              <a href="/tags/Security/" rel="tag"># Security</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/08/29/%E5%A6%82%E4%BD%95%E9%A1%AF%E7%A4%BA%E6%AD%A3%E7%A2%BA%E7%9A%84%E9%8C%AF%E8%AA%A4%E8%A8%8A%E6%81%AF/" rel="prev" title="如何顯示正確的錯誤訊息">
                  <i class="fa fa-angle-left"></i> 如何顯示正確的錯誤訊息
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/01/03/Host-key-verification-failed-on-GitHub/" rel="next" title="Host key verification failed on GitHub">
                  Host key verification failed on GitHub <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Sam Zhu</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/samzhu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.3.0/mermaid.min.js","integrity":"sha256-9y71g5Lz/KLsHjB8uXwnkuWDtAMDSzD/HdIbqhJfTAI="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
